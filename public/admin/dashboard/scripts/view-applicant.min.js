const backToTopBtn=document.getElementById("backToTopBtn"),scrollableElement=document.querySelector(".overflow-y-auto");function toggleApplicationStatusModal(show){document.getElementById("applicationStatusModal").classList.toggle("hidden",!show)}async function updateApplicationStatus(event){event.preventDefault();const btnText=document.querySelector("#updateStatusBtn span"),btnSpinner=document.querySelector("#updateStatusSpinner");btnText.textContent="Saving",btnSpinner.classList.remove("hidden"),setTimeout((()=>{}),2e3);const applicationId=document.getElementById("application_id").innerText,applicationStatus=document.querySelector('select[name="application_status"]').value;console.log("Application ID: ",applicationId);try{const response=await fetch("../../../api/applicants/updateApplicationStatus.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({application_id:applicationId,application_status:applicationStatus})}),data=await response.json();data.status?(Swal.fire({title:"Success!",text:data.message,icon:"success",showConfirmButton:!1,timer:2e3}),viewApplicant(applicationId)):Swal.fire({title:"Error!",text:data.message,icon:"error",confirmButtonText:"OK"})}catch(error){console.error("Error updating application status:",error),Swal.fire({title:"Error!",text:"An unexpected error occurred. Please try again.",icon:"error",confirmButtonText:"OK"})}finally{btnText.textContent="Save",btnSpinner.classList.add("hidden"),toggleApplicationStatusModal(!1)}}function toggleAddUpdateModal(show){document.getElementById("addUpdateModal").classList.toggle("hidden",!show)}function toggleEditUpdateModal(show,button=null){if(document.getElementById("editUpdateModal").classList.toggle("hidden",!show),show&&button){const updateIdField=document.getElementById("editUpdateId"),titleField=document.getElementById("editUpdateTitle"),dateField=document.getElementById("editUpdateDate"),messageField=document.getElementById("editUpdateMessage");if(updateIdField&&titleField&&dateField&&messageField){const updateId=button.getAttribute("data-id"),title=button.getAttribute("data-title"),date=button.getAttribute("data-date"),message=button.getAttribute("data-message");updateIdField.value=updateId,titleField.value=title,dateField.value=date,messageField.value=message}}}function viewApplicant(applicantId){console.log("Loading applicant:",applicantId),fetch(`./pages/view-applicant.php?id=${applicantId}`).then((response=>response.text())).then((applicantInfo=>{document.getElementById("main-content").innerHTML=applicantInfo,console.log(`Loaded applicant with ID: ${applicantId}`)})).catch((error=>{console.error("Error fetching applicant data:",error)}))}function addUpdate(event){event.preventDefault();const btnText=document.querySelector("#addUpdateBtn span"),btnSpinner=document.querySelector("#addUpdateSpinner");btnText.textContent="Saving",btnSpinner.classList.remove("hidden");const applicationId=document.getElementById("application_id").innerText,title=document.getElementById("addUpdateTitle").value,dateTime=document.getElementById("addUpdateDateTime").value,message=document.getElementById("addUpdateMessage").value;fetch("../../../api/update/addUpdate.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({application_id:applicationId,title:title,date_time:dateTime,message:message})}).then((response=>response.json())).then((data=>{data.status?Swal.fire({title:"Success!",text:data.message,icon:"success",confirmButtonText:"OK"}).then((()=>{document.getElementById("addUpdateForm").reset(),viewApplicant(applicationId)})):Swal.fire({title:"Error!",text:data.message,icon:"error",confirmButtonText:"OK"})})).catch((error=>{console.error("Error adding update:",error),Swal.fire({title:"Error!",text:"An unexpected error occurred while adding the update.",icon:"error",confirmButtonText:"OK"})})).finally((()=>{btnText.textContent="Save",btnSpinner.classList.add("hidden"),toggleAddUpdateModal(!1)}))}function editUpdate(event){event.preventDefault();const btnText=document.querySelector("#editUpdateBtn span"),btnSpinner=document.querySelector("#editUpdateSpinner");btnText.textContent="Saving",btnSpinner.classList.remove("hidden");const updateId=document.getElementById("editUpdateId").value,title=document.getElementById("editUpdateTitle").value,dateTime=document.getElementById("editUpdateDate").value,message=document.getElementById("editUpdateMessage").value;setTimeout((()=>{}),2e3),fetch("../../../api/update/editUpdate.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({update_id:updateId,title:title,date_time:dateTime,message:message})}).then((response=>response.json())).then((data=>{data.status?Swal.fire({title:"Success!",text:data.message,icon:"success",confirmButtonText:"OK"}).then((()=>{document.getElementById("editUpdateForm").reset(),toggleEditUpdateModal(!1),viewApplicant(document.getElementById("application_id").innerText)})):Swal.fire({title:"Error!",text:data.message,icon:"error",confirmButtonText:"OK"})})).catch((error=>{console.error("Error editing update:",error),Swal.fire({title:"Error!",text:"An unexpected error occurred while editing the update.",icon:"error",confirmButtonText:"OK"}).finally((()=>{btnText.textContent="Save",btnSpinner.classList.add("hidden")}))}))}function deleteUpdate(updateId){fetch("../../../api/update/deleteUpdate.php",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({update_id:updateId})}).then((response=>response.json())).then((data=>{data.status?Swal.fire({title:"Success!",text:data.message,icon:"success",confirmButtonText:"OK"}).then((()=>{viewApplicant(document.getElementById("application_id").innerText)})):Swal.fire({title:"Error!",text:data.message,icon:"error",confirmButtonText:"OK"})})).catch((error=>{console.error("Error deleting update:",error),Swal.fire({title:"Error!",text:"An unexpected error occurred while deleting the update.",icon:"error",confirmButtonText:"OK"})}))}function saveForm(){const element=document.getElementById("application_details"),opt={margin:1,filename:`${(document.getElementById("applicant_name").innerText||"application").replace(/\s+/g,"_")}_form.pdf`,image:{type:"jpeg",quality:1},html2canvas:{scale:2},jsPDF:{unit:"in",format:"letter",orientation:"portrait"}},btn=document.querySelector('[onclick="saveForm()"]'),originalText=btn.innerText;btn.innerHTML='\n        <span class="inline-block">Downloading...</span>\n        <svg class="w-4 h-4 ml-2 inline-block animate-spin" viewBox="0 0 24 24">\n            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>\n            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>\n        </svg>',btn.disabled=!0,html2pdf().set(opt).from(element).save().then((()=>{btn.innerHTML=originalText,btn.disabled=!1})).catch((error=>{console.error("Error generating PDF:",error),Swal.fire({title:"Error!",text:"Failed to generate PDF. Please try again.",icon:"error",confirmButtonText:"OK"}),btn.innerHTML=originalText,btn.disabled=!1}))}scrollableElement.addEventListener("scroll",(()=>{scrollableElement.scrollTop>300?(backToTopBtn.classList.remove("opacity-0","invisible"),backToTopBtn.classList.add("opacity-100","visible")):(backToTopBtn.classList.add("opacity-0","invisible"),backToTopBtn.classList.remove("opacity-100","visible"))}));