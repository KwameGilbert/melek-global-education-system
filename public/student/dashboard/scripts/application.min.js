function loadApplications(){Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,didOpen:toast=>{toast.addEventListener("mouseenter",Swal.stopTimer),toast.addEventListener("mouseleave",Swal.resumeTimer)}}).fire({title:"Loading your application form...",timer:3e3,timerProgressBar:!0}),document.getElementById("add-study-entry").addEventListener("click",(function(event){event.preventDefault();const container=document.getElementById("study-experience-container"),newEntry=document.querySelector(".study-entry").cloneNode(!0);newEntry.querySelectorAll("input").forEach((input=>{input.value=""})),container.appendChild(newEntry)})),document.getElementById("add-work-entry").addEventListener("click",(function(event){event.preventDefault();const container=document.getElementById("work-history-container"),newEntry=document.querySelector(".work-entry").cloneNode(!0);newEntry.querySelectorAll("input").forEach((input=>{input.value=""})),container.appendChild(newEntry)}))}async function fetchSchools(){const countryId=document.getElementById("major_country").value,schoolDropdown=document.getElementById("major_school"),degreeDropdown=document.getElementById("major_degree"),programDropdown=document.getElementById("major_program"),studyDuration=document.getElementById("study_duration");if(schoolDropdown.innerHTML='<option value="">Select a school</option>',degreeDropdown.innerHTML='<option value="">Select a degree</option>',programDropdown.innerHTML='<option value="">Select a program</option>',studyDuration.value="",schoolDropdown.disabled=!0,degreeDropdown.disabled=!0,programDropdown.disabled=!0,countryId){const response=await fetch(`../../../api/application_form/fetch_schools.php?country_id=${countryId}`),schools=await response.json();schools.length>0&&(schools.forEach((school=>{const option=document.createElement("option");option.value=school.school_id,option.textContent=school.school_name,schoolDropdown.appendChild(option)})),schoolDropdown.disabled=!1)}}async function fetchDegrees(){const schoolId=document.getElementById("major_school").value,degreeDropdown=document.getElementById("major_degree"),programDropdown=document.getElementById("major_program"),studyDuration=document.getElementById("study_duration");if(degreeDropdown.innerHTML='<option value="">Select a degree</option>',programDropdown.innerHTML='<option value="">Select a program</option>',studyDuration.value="",degreeDropdown.disabled=!0,programDropdown.disabled=!0,schoolId){const response=await fetch(`../../../api/application_form/fetch_degrees.php?school_id=${schoolId}`),degrees=await response.json();degrees.length>0&&(degrees.forEach((degree=>{const option=document.createElement("option");option.value=degree.degree_id,option.textContent=degree.degree_name,degreeDropdown.appendChild(option)})),degreeDropdown.disabled=!1)}}async function fetchPrograms(){const schoolId=document.getElementById("major_school").value,degree=document.getElementById("major_degree").value,programDropdown=document.getElementById("major_program"),studyDuration=document.getElementById("study_duration");if(programDropdown.innerHTML='<option value="">Select a program</option>',studyDuration.value="",programDropdown.disabled=!0,schoolId&&degree){const response=await fetch(`../../../api/application_form/fetch_programs.php?school_id=${schoolId}&degree=${degree}`),programs=await response.json();programs.length>0&&(programs.forEach((program=>{const option=document.createElement("option");option.value=program.program_id,option.textContent=program.program_name,option.dataset.duration=program.program_duration,programDropdown.appendChild(option)})),programDropdown.disabled=!1)}}function showDuration(){const programDropdown=document.getElementById("major_program"),studyDuration=document.getElementById("study_duration"),selectedOption=programDropdown.options[programDropdown.selectedIndex];selectedOption.dataset.duration?studyDuration.value=`${selectedOption.dataset.duration} years`:studyDuration.value=""}function saveApplication(event){event.preventDefault();const form=document.getElementById("application-form"),formData=new FormData(form),formDataObj={};formData.forEach(((value,key)=>{formDataObj[key]=value})),fetch("../../../api/application_form/save_application.php",{method:"POST",body:formData}).then((response=>response.json())).then((data=>{const work_study=work_study_history();data.success&&work_study?Swal.fire({icon:"success",title:"Application submitted successfully",text:data.message}):Swal.fire({icon:"error",title:"Application submission failed",text:data.message})}))}async function handleFileUpload(event){const input=event.target,file=input.files[0],toastMixin=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0});if(!file)return void toastMixin.fire({icon:"warning",title:"Warning",text:"No file selected for upload."});Swal.fire({title:"Uploading...",text:`Uploading ${input.name}. Please wait.`,allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>{Swal.showLoading()}});const formData=new FormData;formData.append(input.name,file);try{const response=await fetch("../../../api/student/documents/upload.php",{method:"POST",body:formData}),data=await response.json();Swal.close(),data.success?toastMixin.fire({icon:"success",title:"Success",text:`${input.name} uploaded successfully!`}):toastMixin.fire({icon:"error",title:"Upload Failed",text:data.message||`An error occurred while uploading ${input.name}.`})}catch(error){Swal.close(),toastMixin.fire({icon:"error",title:"Error",text:`An unexpected error occurred: ${error.message}`})}}function work_study_history(){let studyExperienceData=[],workHistoryData=[];document.querySelectorAll(".study-entry").forEach((entry=>{const schoolName=entry.querySelector(".school-name").value,degree=entry.querySelector(".degree").value,attendancePeriod=entry.querySelector(".attendance-period").value,contactPerson=entry.querySelector(".contact-person").value;studyExperienceData.push({school_name:schoolName,degree:degree,attendance_period:attendancePeriod,contact_person:contactPerson})}));document.querySelectorAll(".work-entry").forEach((entry=>{const startDate=entry.querySelector('[name="start_date"]').value,endDate=entry.querySelector('[name="end_date"]').value,position=entry.querySelector('[name="position"]').value,company=entry.querySelector('[name="company"]').value,companyPhone=entry.querySelector('[name="company_phone"]').value,companyEmail=entry.querySelector('[name="company_email"]').value;workHistoryData.push({start_date:startDate,end_date:endDate,position:position,company:company,company_phone:companyPhone,company_email:companyEmail})}));const formData=new FormData;formData.append("study_experience",JSON.stringify(studyExperienceData)),formData.append("work_history",JSON.stringify(workHistoryData)),fetch("../../../api/application_form/work-study-experience.php",{method:"POST",body:formData}).then((response=>response.json())).then((data=>!!data.success)).catch((error=>(console.error("Error:",error),!1)))}